// The MIT License (MIT)
// Â© mihakralj
//@version=6
indicator("Chaikin A/D Oscillator", "ADOSC", overlay=false)

adosc(simple int shortPeriod, simple int longPeriod) =>
    float EPSILON = 1e-10
    if shortPeriod <= 0 or longPeriod <= 0
        runtime.error("Periods must be greater than 0")
    short_alpha = 2.0 / (shortPeriod + 1)
    long_alpha = 2.0 / (longPeriod + 1)
    one_minus_long_alpha = 1.0 - long_alpha
    float rng = high - low
    float mf = rng != 0.0 ? ((2 * close - high - low) / rng) * volume : 0.0
    var float cum = 0.0
    var float e = 1.0
    cum := bar_index == 0 ? mf : cum + mf
    var float short_raw_ema = 0.0
    short_raw_ema := short_alpha * (cum - short_raw_ema) + short_raw_ema
    float short_ema = e > EPSILON ? short_raw_ema / (1.0 - e) : short_raw_ema
    var float long_raw_ema = 0.0
    long_raw_ema := long_alpha * (cum - long_raw_ema) + long_raw_ema
    float long_ema = e > EPSILON ? long_raw_ema / (1.0 - e) : long_raw_ema
    e := one_minus_long_alpha * e
    short_ema - long_ema
    
// ---------- Main Loop ----------
// Inputs
shortPeriod = input.int(3, "Short Period", minval=1)
longPeriod = input.int(10, "Long Period", minval=1)
// Calculation

osc = adosc(shortPeriod, longPeriod)

// Plot
plot(osc, "ADOSC", color=color.new(color.yellow, 0), linewidth=2)
