// The MIT License (MIT)
// Â© mihakralj
//@version=6
indicator("Zero-Lag Exponential Moving Average (ZLEMA)", "ZLEMA", overlay=true)

//@function Calculates ZLEMA using zero-lag price and exponential smoothing with compensator
//@doc https://github.com/mihakralj/pinescript/blob/main/indicators/trends_IIR/zlema.md
//@param source Series to calculate ZLEMA from
//@param period Smoothing period
//@returns ZLEMA value with zero-lag effect applied
//@optimized for performance and dirty data
zlema(series float source, simple int period) =>
    if period <= 0
        runtime.error("Period must be greater than 0")
    float alpha = 2.0 / (period + 1.0)
    simple int lag = math.max(1, math.round((period - 1) / 2))
    var float zlemaValue = na
    var priceBuffer = array.new<float>(lag + 1, 0.0)
    if not na(source)
        if na(zlemaValue)
            zlemaValue := source
            array.fill(priceBuffer, source)
        else
            array.shift(priceBuffer)
            array.push(priceBuffer, source)
            float laggedPrice = array.get(priceBuffer, 0)
            float signal = 2 * source - laggedPrice
            zlemaValue := zlemaValue + alpha * (signal - zlemaValue)
    zlemaValue


// ---------- Main loop ----------

// Inputs
i_period = input.int(10, "Period", minval=1, tooltip="Default period is 20, adjust as needed")
i_source = input.source(close, "Source")

// Calculation
alpha = 2.0/(float(i_period)+1.0)  
zlema = zlema(i_source, i_period)

// Plot
plot(zlema, "ZLEMA", color.new(color.yellow, 0), 2)
